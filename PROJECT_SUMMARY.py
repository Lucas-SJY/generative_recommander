"""
Amazon æ¨èç³»ç»Ÿ - é¡¹ç›®å®Œæˆæ€»ç»“
================================

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº LLM å’Œå‘é‡ç›¸ä¼¼æ€§æœç´¢çš„ç”µå•†æ¨èç³»ç»Ÿã€‚
ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€ä¸ç³»ç»Ÿäº¤äº’ï¼Œè·å¾—ä¸ªæ€§åŒ–çš„å•†å“æ¨èã€‚

ğŸ“¦ é¡¹ç›®ç»“æ„
===========

yi/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py            # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ models.py              # SQLAlchemy ORM æ¨¡å‹
â”‚   â”œâ”€â”€ schemas.py             # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ ollama_client.py       # Ollama API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ recommendation_engine.py # æ¨èå¼•æ“æ ¸å¿ƒ
â”‚   â””â”€â”€ load_data.py           # æ•°æ®åŠ è½½è„šæœ¬
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.py                # å‰ç«¯æœåŠ¡å™¨ (FastAPI)
â”‚   â””â”€â”€ index.html             # Web ç•Œé¢
â”‚
â”œâ”€â”€ dataset/                    # Amazon æ•°æ®é›†
â”‚   â””â”€â”€ raw/
â”‚       â”œâ”€â”€ meta_categories/   # å•†å“å…ƒæ•°æ® (JSONL)
â”‚       â””â”€â”€ review_categories/ # å•†å“è¯„ä»· (JSONL)
â”‚
â”œâ”€â”€ db/                        # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ ddl/
â”‚       â””â”€â”€ yddl.ddl           # æ•°æ®åº“ DDL è„šæœ¬
â”‚
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ requirements.txt           # Python ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ run.py                     # æ™ºèƒ½å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_services.sh          # Bash å¯åŠ¨è„šæœ¬
â”œâ”€â”€ health_check.py            # ç³»ç»Ÿå¥åº·æ£€æŸ¥
â”œâ”€â”€ db_utils.py                # æ•°æ®åº“å·¥å…·
â”œâ”€â”€ dev_test.py                # å¼€å‘æµ‹è¯•è„šæœ¬
â”œâ”€â”€ README.md                  # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md              # å¿«é€Ÿå¼€å§‹æŒ‡å—
â””â”€â”€ ARCHITECTURE.md            # æ¶æ„è¯¦è§£


ğŸš€ å¿«é€Ÿå¼€å§‹
===========

1. ç¯å¢ƒå‡†å¤‡ (5 åˆ†é’Ÿ)
   $ pip install -r requirements.txt
   
2. å¯åŠ¨å¿…è¦æœåŠ¡
   - PostgreSQL (éœ€è¦ pgvector æ‰©å±•)
   - Ollama (qwen2.5:14b + nomic-embed-text)

3. åŠ è½½æ•°æ® (1-8 å°æ—¶ï¼Œå–å†³äºæ•°æ®é‡)
   $ python backend/load_data.py

4. å¯åŠ¨ç³»ç»Ÿ
   $ python run.py
   
5. æ‰“å¼€æµè§ˆå™¨
   http://0.0.0.0:8001


ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯
============

åç«¯æ¡†æ¶:
- FastAPI: ç°ä»£ Python Web æ¡†æ¶
- SQLAlchemy: ORM æ•°æ®åº“ç®¡ç†
- Pydantic: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

æ•°æ®å­˜å‚¨:
- PostgreSQL: å…³ç³»æ•°æ®åº“
- pgvector: å‘é‡æ•°æ®åº“æ‰©å±•
- HNSW: å‘é‡ç´¢å¼•åŠ é€Ÿ

å¤§æ¨¡å‹:
- qwen2.5:14b: æ–‡æœ¬ç”Ÿæˆ (æ„å›¾ç†è§£ã€å›å¤)
- nomic-embed-text: æ–‡æœ¬å‘é‡åŒ– (768 ç»´)

å‰ç«¯:
- HTML5 + CSS3 + Vanilla JavaScript
- å“åº”å¼è®¾è®¡
- å®æ—¶äº¤äº’


ğŸ“‹ API æ¥å£
===========

åç«¯ API åœ°å€: http://0.0.0.0:8000

1. æ¨èæ¥å£
   POST /api/recommend
   {
     "query": "ç”¨æˆ·è‡ªç„¶è¯­è¨€æè¿°",
     "session_id": "å¯é€‰",
     "user_id": "å¯é€‰"
   }
   
2. å¯¹è¯æ¥å£
   POST /api/chat
   {
     "session_id": "ä¼šè¯ID",
     "message": "ç”¨æˆ·æ¶ˆæ¯"
   }

3. å•†å“è¯¦æƒ…
   POST /api/item-details
   {"asin": "å•†å“ID"}

å®Œæ•´æ–‡æ¡£: http://0.0.0.0:8000/docs (Swagger)


ğŸ’¾ æ•°æ®åº“æ¶æ„
=============

Schema: lmrc

è¡¨ç»“æ„:
- items: å•†å“ä¸»è¡¨ (5000+ å­—æ®µ)
- item_embeddings: å‘é‡å­˜å‚¨ (768 ç»´ï¼ŒHNSW ç´¢å¼•)
- reviews_summary: è¯„è®ºæ‘˜è¦
- sessions: ç”¨æˆ·ä¼šè¯
- events: äº¤äº’äº‹ä»¶æ—¥å¿—

ç´¢å¼•:
- idx_item_embeddings_hnsw: å‘é‡ç›¸ä¼¼æœç´¢
- idx_items_title_trgm: å…¨æ–‡æœç´¢
- idx_items_category: åˆ†ç±»ç´¢å¼•
- idx_events_session: ä¼šè¯ç´¢å¼•


ğŸ”„ å·¥ä½œæµç¨‹
===========

ç”¨æˆ·è¾“å…¥ (è‡ªç„¶è¯­è¨€)
  â†“
[LLM] ç†è§£æ„å›¾ & æå–å…³é”®è¯
  â†“
[Embedding] ç”ŸæˆæŸ¥è¯¢å‘é‡
  â†“
[å‘é‡æœç´¢] pgvector HNSW æœç´¢ (O(log n))
  â†“
[æ’åº] é€‰æ‹©æœ€ç›¸å…³çš„ TopN
  â†“
[LLM] ç”Ÿæˆæ¨èæè¿°
  â†“
[å‰ç«¯] å±•ç¤ºç»“æœ


ğŸ“Š æ€§èƒ½æŒ‡æ ‡
===========

- å•æ¬¡æŸ¥è¯¢å»¶è¿Ÿ: 5-10 ç§’ (å« LLM è°ƒç”¨)
- å‘é‡æœç´¢é€Ÿåº¦: <100ms (TopK=80)
- æ¨èè¿”å›æ•°: 8 ä¸ª (å¯é…ç½®)
- æ•°æ®åº“å®¹é‡: æ•°ç™¾ä¸‡å•†å“ (æ‰©å±•æ€§å¼º)


ğŸ§ª æµ‹è¯•å·¥å…·
===========

$ python health_check.py        # ç³»ç»Ÿæ£€æŸ¥
$ python db_utils.py            # æ•°æ®åº“ç»Ÿè®¡
$ python dev_test.py            # æ¨èæµ‹è¯•
$ python dev_test.py --all      # æ‰¹é‡æµ‹è¯•


ğŸ“š æ–‡æ¡£è¯´æ˜
===========

README.md:
- å®Œæ•´ç³»ç»Ÿè¯´æ˜
- API æ–‡æ¡£
- å¸¸è§é—®é¢˜

QUICKSTART.md:
- åˆ†æ­¥å¿«é€Ÿå¼€å§‹æŒ‡å—
- æ•…éšœæ’é™¤
- æ—¶é—´é¢„ä¼°

ARCHITECTURE.md:
- æ¶æ„å›¾
- æ¨¡å—è¯¦è§£
- æ€§èƒ½ä¼˜åŒ–
- æ‰©å±•æŒ‡å—


ğŸ”§ é…ç½®æ–‡ä»¶ (.env)
===================

DATABASE_URL=postgresql+psycopg://postgres:postgres@0.0.0.0:5432/recsys
OLLAMA_BASE_URL=http://0.0.0.0:11434
LLM_MODEL=qwen2.5:14b
EMBED_MODEL=nomic-embed-text
RETRIEVE_TOPK=80        # æœç´¢è¿”å›å‰ 80 ä¸ª
RETURN_TOPN=8           # æœ€ç»ˆæ¨èå‰ 8 ä¸ª
OLLAMA_TIMEOUT_S=60


ğŸ¯ ä¸»è¦åŠŸèƒ½
===========

âœ… è‡ªç„¶è¯­è¨€ç†è§£
   - æ”¯æŒä¸­æ–‡è¾“å…¥
   - æ„å›¾è¯†åˆ«
   - å…³é”®è¯æå–

âœ… æ™ºèƒ½æ¨è
   - å‘é‡ç›¸ä¼¼æœç´¢
   - å¤šç»´åº¦æ’åº
   - ä¸ªæ€§åŒ–ç»“æœ

âœ… å¤šè½®å¯¹è¯
   - ä¼šè¯ç®¡ç†
   - ä¸Šä¸‹æ–‡è®°å¿†
   - å‹å¥½å›å¤

âœ… æ•°æ®è¿½è¸ª
   - äº‹ä»¶æ—¥å¿—
   - ç”¨æˆ·è¡Œä¸ºè®°å½•
   - æ€§èƒ½ç›‘æ§


âš¡ æ€§èƒ½ä¼˜åŒ–äº®ç‚¹
================

1. å‘é‡ç´¢å¼•
   - HNSW ç®—æ³•
   - O(log n) æŸ¥è¯¢å¤æ‚åº¦
   - é«˜ç»´å‘é‡é«˜æ•ˆæœç´¢

2. æ‰¹é‡å¤„ç†
   - æ‰¹é‡ Embedding
   - æ‰¹é‡æ•°æ®åº“æ“ä½œ
   - å‡å°‘ç½‘ç»œå¾€è¿”

3. è¿æ¥ç®¡ç†
   - ä½¿ç”¨ NullPool é¿å…è¿æ¥æ³„æ¼
   - åˆç†çš„è¶…æ—¶è®¾ç½®
   - é”™è¯¯é‡è¯•æœºåˆ¶

4. ç¼“å­˜ç­–ç•¥
   - å¯æ‰©å±•çš„ç¼“å­˜å±‚
   - çƒ­ç‚¹æ•°æ®ä¼˜åŒ–
   - LRU é©±é€ç­–ç•¥


ğŸ” å®‰å…¨ç‰¹æ€§
===========

âœ“ SQL æ³¨å…¥é˜²æŠ¤ (SQLAlchemy ORM)
âœ“ è¾“å…¥éªŒè¯ (Pydantic)
âœ“ CORS é…ç½®
âœ“ ä¼šè¯éš”ç¦»
âœ“ é”™è¯¯å¤„ç†


ğŸš¢ éƒ¨ç½²å°±ç»ª
===========

âœ“ æ—  Docker Compose (æŒ‰è¦æ±‚)
âœ“ æ‰€æœ‰ä»£ç æœ¬åœ°è¿è¡Œ
âœ“ å®Œæ•´çš„é”™è¯¯å¤„ç†
âœ“ æ—¥å¿—è®°å½•
âœ“ å¥åº·æ£€æŸ¥
âœ“ å¯åŠ¨è„šæœ¬


ğŸ“¦ ä¾èµ–æ¸…å•
===========

fastapi==0.104.1         # Web æ¡†æ¶
uvicorn==0.24.0          # ASGI æœåŠ¡å™¨
sqlalchemy==2.0.23       # ORM
psycopg==3.17.0          # PostgreSQL é©±åŠ¨
pgvector==0.2.4          # å‘é‡æ‰©å±•
python-dotenv==1.0.0     # ç¯å¢ƒå˜é‡
pydantic==2.5.0          # æ•°æ®éªŒè¯
requests==2.31.0         # HTTP å®¢æˆ·ç«¯
numpy==1.24.3            # æ•°å€¼è®¡ç®—
pandas==2.0.3            # æ•°æ®å¤„ç†
tqdm==4.66.1             # è¿›åº¦æ¡


ğŸ“ å­¦ä¹ è·¯å¾„
===========

1. äº†è§£é¡¹ç›®ç»“æ„
   $ ls -la

2. é˜…è¯»æ–‡æ¡£
   - README.md (æ¦‚è§ˆ)
   - QUICKSTART.md (å¿«é€Ÿå¼€å§‹)
   - ARCHITECTURE.md (æ·±å…¥ç†è§£)

3. æŸ¥çœ‹ä»£ç 
   - backend/recommendation_engine.py (æ ¸å¿ƒé€»è¾‘)
   - backend/ollama_client.py (LLM é›†æˆ)
   - frontend/index.html (UI ä»£ç )

4. è¿è¡Œç¤ºä¾‹
   $ python dev_test.py "æˆ‘æƒ³è¦ä¸€ä¸ªå¥½çš„é¼ æ ‡"

5. ä¿®æ”¹å’Œæ‰©å±•
   - è°ƒæ•´ Prompt
   - æ·»åŠ æ–°çš„æ¨èç­–ç•¥
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢


ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®
=============

1. æ•°æ®ä¼˜åŒ–
   - åŠ è½½å®Œæ•´æ•°æ®é›†
   - ç”Ÿæˆæ‰€æœ‰å•†å“çš„å‘é‡
   - å»ºç«‹å®Œæ•´çš„ç´¢å¼•

2. åŠŸèƒ½æ‰©å±•
   - ç”¨æˆ·åé¦ˆç³»ç»Ÿ
   - A/B æµ‹è¯•æ¡†æ¶
   - æ¨èè§£é‡Šæ€§

3. æ€§èƒ½ä¼˜åŒ–
   - Redis ç¼“å­˜
   - å¼‚æ­¥å¤„ç†
   - æ¨¡å‹é‡åŒ–

4. ç›‘æ§å’Œåˆ†æ
   - Prometheus æŒ‡æ ‡
   - æ—¥å¿—èšåˆ
   - ç”¨æˆ·è¡Œä¸ºåˆ†æ

5. ç”Ÿäº§åŒ–
   - å®¹å™¨åŒ–éƒ¨ç½²
   - è´Ÿè½½å‡è¡¡
   - è“ç»¿éƒ¨ç½²


ğŸ“ æ•…éšœæ’é™¤
===========

é—®é¢˜: è¿æ¥å¤±è´¥
è§£å†³: æ£€æŸ¥ PostgreSQL å’Œ Ollama æ˜¯å¦è¿è¡Œ

é—®é¢˜: æ¨èä¸ºç©º
è§£å†³: è¿è¡Œ python backend/load_data.py åŠ è½½æ•°æ®

é—®é¢˜: å“åº”å¾ˆæ…¢
è§£å†³: æ£€æŸ¥ Ollama æ¨¡å‹æ˜¯å¦å·²åŠ è½½

è¯¦ç»†è¯´æ˜è§ README.md å’Œ QUICKSTART.md


âœ¨ é¡¹ç›®äº®ç‚¹
===========

â­ å®Œæ•´çš„ç”Ÿäº§çº§åˆ«ä»£ç 
â­ è¯¦ç»†çš„æ–‡æ¡£å’Œæ³¨é‡Š
â­ æ™ºèƒ½çš„é”™è¯¯å¤„ç†
â­ å“åº”å¼çš„å‰ç«¯ç•Œé¢
â­ é«˜æ•ˆçš„å‘é‡æœç´¢
â­ çµæ´»çš„æ‰©å±•æ€§
â­ å®Œæ•´çš„æµ‹è¯•å·¥å…·
â­ æ˜“ç”¨çš„å¯åŠ¨è„šæœ¬


ğŸ‰ é¡¹ç›®å®Œæˆï¼
=============

æ‰€æœ‰ä»£ç å·²å‡†å¤‡å°±ç»ªï¼ŒæŒ‰ç…§ QUICKSTART.md æ“ä½œå³å¯å¼€å§‹ä½¿ç”¨ã€‚

é¢„ç¥ä½¿ç”¨æ„‰å¿«ï¼


"""

print(__doc__)
